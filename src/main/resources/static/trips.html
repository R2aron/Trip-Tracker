<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Trips from Database</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2rem; background:#f9f9f9; color:#333; }
        h1 { text-align: center; }
        #refresh { display:block; margin: 0 auto 1rem; padding:.5rem 1rem; border-radius:8px; border:1px solid #ccc; background:#fff; cursor:pointer; }
        .trip-card { background:#fff; border-radius:10px; padding:1rem; margin:1rem auto; max-width:700px; box-shadow:0 2px 5px rgba(0,0,0,.08); }
        .trip-card h2 { margin:.2rem 0 .4rem; color:#0a66c2; font-size:1.2rem; }
        .meta { display:flex; gap:1rem; flex-wrap:wrap; font-size:.95rem; }
        .meta div { background:#f2f6ff; padding:.25rem .5rem; border-radius:6px; }
        .sub { margin-top:.5rem; font-size:.95rem; color:#555; }
    </style>
</head>
<body>
<h1>Trips from Database</h1>
<button id="refresh">Refresh</button>
<div id="trip-list">Loading…</div>

<script>
    function prettyDateTime(v){
      if(!v) return "N/A";
      try { return new Date(v).toLocaleString(); } catch { return v; }
    }

    async function loadTrips() {
      const container = document.getElementById("trip-list");
      container.textContent = "Loading…";
      try {
        const res = await fetch("/api/trips", { headers: { "Accept": "application/json" }});
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();         // <- aici eșua dacă răspunsul nu era JSON
        if (!Array.isArray(data)) throw new Error("Expected JSON array, got " + typeof data);

        if (data.length === 0) {
          container.innerHTML = "<p>No trips yet.</p>";
          return;
        }

        container.innerHTML = "";
        data.forEach(trip => {
          const card = document.createElement("div");
          card.className = "trip-card";
          card.innerHTML = `
            <h2>${trip.name ?? "(no name)"} — ${trip.destination ?? "N/A"}</h2>
            <div class="meta">
              <div><strong>Days:</strong> ${trip.days ?? "N/A"}</div>
              <div><strong>Start:</strong> ${prettyDateTime(trip.startOfTrip)}</div>
              <div><strong>ID:</strong> ${trip.id ?? "—"}</div>
            </div>
            <div class="sub"><strong>Itinerary items:</strong> ${Array.isArray(trip.itineraryItems) ? trip.itineraryItems.length : 0}</div>
            <div class="sub"><strong>Accommodations:</strong> ${Array.isArray(trip.accommodations) ? trip.accommodations.length : 0}</div>
            <div class="sub"><strong>Transportations:</strong> ${Array.isArray(trip.transportations) ? trip.transportations.length : 0}</div>
          `;
          container.appendChild(card);
        });
      } catch (err) {
        container.innerHTML = `<p style="color:red;">Error: ${err.message}</p>`;
      }
    }

    document.getElementById("refresh").addEventListener("click", loadTrips);
    loadTrips();
</script>
</body>
</html>
